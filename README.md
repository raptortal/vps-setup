# vps-setup

–°–∫—Ä–∏–ø—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VPS Ubuntu (—É—Ç–∏–ª–∏—Ç—ã + BBR + fail2ban)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–ï—Å–ª–∏ `wget` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
```bash
apt update && apt install -y wget
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
wget -O- https://raw.githubusercontent.com/raptortal/vps-setup/main/setup.sh | bash
```

> ‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)

---

## ‚≠êÔ∏è –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- –ü–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ª—é–±–æ–≥–æ VPN (–≤–∫–ª—é—á–∞—è Amnezia VPN, WireGuard, OpenVPN) ‚Äî —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –±—ã–ª –≥–æ—Ç–æ–≤.
- –¢–æ–ª—å–∫–æ –∞—Ä–µ–Ω–¥–æ–≤–∞–ª/–∫—É–ø–∏–ª VPS –Ω–∞ Ubuntu ‚Äî —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ —Å–¥–µ–ª–∞—Ç—å –±–∞–∑–æ–≤—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É.  
- –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ ‚Äî —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤–æ –∏ –±—ã—Å—Ç—Ä–µ–µ.  
- –ù–æ–≤–∏—á–∫–∞–º ‚Äî —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤—Å—ë –≤—Ä—É—á–Ω—É—é –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–±—ã—Ç—å.  
- –¢–µ–º, —É –∫–æ–≥–æ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å/–ø–∏–Ω–≥ ‚Äî —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å BBR –∏ —É–ª—É—á—à–∏—Ç—å —Å–µ—Ç—å.  
- –¢–µ–º, –∫—Ç–æ —Ö–æ—á–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å SSH ‚Äî —á—Ç–æ–±—ã –º–µ–Ω—å—à–µ –ª–æ–≤–∏—Ç—å –±—Ä—É—Ç—Ñ–æ—Ä—Å-–∞—Ç–∞–∫–∏.  
- –ü–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø—Ä–æ–∫—Å–∏/—Ç—É–Ω–Ω–µ–ª–µ–π –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Äî –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥.  
- –ê–¥–º–∏–Ω–∞–º/DevOps ‚Äî –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ Ubuntu.
  
---

## üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

- üîê **–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è** ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å root (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ** ‚Äî `apt update && apt upgrade`
- üõ†Ô∏è **–£—Ç–∏–ª–∏—Ç—ã** ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –ø–æ–ª–µ–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- üõ°Ô∏è **fail2ban** ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ SSH
- üíæ **Swap 1 –ì–ë** ‚Äî —Å–æ–∑–¥–∞—ë—Ç swap-—Ñ–∞–π–ª, –µ—Å–ª–∏ –µ–≥–æ –µ—â—ë –Ω–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚ö° **BBR** ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç TCP BBR + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏
- üîÅ **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞** ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìã –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã

| –£—Ç–∏–ª–∏—Ç–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|:--------|:-----------|
| `htop` | üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |
| `nano` | üìù –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä |
| `speedtest-cli` | üåê –¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ |
| `mtr` | üîç –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ + –ø–∏–Ω–≥ |
| `traceroute` | üõ§ –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞ |
| `iftop` | üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ |
| `nmap` | üîé –°–∫–∞–Ω–µ—Ä –ø–æ—Ä—Ç–æ–≤ |
| `curl` | üîó –ü—Ä–æ–≤–µ—Ä–∫–∏/—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ URL |
| `lsof` | üîå –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç/—Ñ–∞–π–ª |
| `whois` | üßæ –ò–Ω—Ñ–æ –ø–æ –¥–æ–º–µ–Ω—É/IP |
| `mc` | üóÇ –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ |
| `fail2ban` | üõ° –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ |

---


## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nf_conntrack

–ï—Å–ª–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ VPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∞—é—Ç –∏–ª–∏ –æ–±—Ä—ã–≤–∞—é—Ç—Å—è ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç conntrack. –û—Å–æ–±–µ–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –Ω–µ–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º RAM, –≥–¥–µ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–Ω–∏–∂–∞–µ—Ç –ª–∏–º–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–í–∞–∂–Ω–æ:** –∫–∞–∂–¥–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç ~320 –±–∞–π—Ç RAM. –ù–∞–ø—Ä–∏–º–µ—Ä, 65536 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚âà 20 –ú–ë, 262144 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚âà 80 –ú–ë.

### –ß—Ç–æ —ç—Ç–æ?

`nf_conntrack` ‚Äî –º–æ–¥—É–ª—å —è–¥—Ä–∞ Linux, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—â–∏–π —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç –∏—Å—Ö–æ–¥—è –∏–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ RAM, –Ω–æ –∏–Ω–æ–≥–¥–∞ **–∑–∞–Ω–∏–∂–∞–µ—Ç** –µ–≥–æ.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```bash
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
cat /proc/sys/net/netfilter/nf_conntrack_max

# –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
cat /proc/sys/net/netfilter/nf_conntrack_count
```
–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 65536 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (~20 –ú–ë RAM).

## –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å
```bash
# –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ –∫–æ–Ω—Ñ–∏–≥ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
echo "net.netfilter.nf_conntrack_max = 65536" >> /etc/sysctl.conf

# –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
sysctl -p
```
---



## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ubuntu 20.04 / 22.04 / 24.04 +
- –ü—Ä–∞–≤–∞ root

---
